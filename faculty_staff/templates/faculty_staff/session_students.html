{% extends 'faculty_staff/base_dashboard.html' %}

{% block title %}Session Students - {{ session.name }}{% endblock %}

{% block content %}
<div class="">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Header -->
        <div class="hero bg-primary text-primary-content rounded-lg shadow-lg mb-6">
            <div class="hero-content text-center py-6">
                <div class="max-w-md">
                    <h1 class="text-3xl sm:text-4xl font-bold mb-2">Students in Session: {{ session.name }}</h1>
                    <p class="text-base sm:text-lg text-primary-content/90">Manage students enrolled in this session for {{ department.name }}</p>
                </div>
            </div>
        </div>

        <!-- Search Form -->
        <div class="card bg-base-100 shadow-lg">
            <div class="card-body">
                <h2 class="card-title text-xl text-base-content mb-4">
                    <i class="fas fa-search mr-2"></i>
                    Search Students
                </h2>
                <form method="get" action="" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-sm text-base-content">Search by Roll No or Name</span>
                            </label>
                            <input type="text" name="q" class="input input-bordered text-sm text-base-content" placeholder="Search by Roll No or Name" value="{{ request.GET.q|default:'' }}">
                        </div>
                        <div class="form-control flex gap-2">
                            <button type="submit" class="btn btn-sm btn-primary">
                                <i class="fas fa-search mr-2"></i>
                                Search
                            </button>
                            <a href="{% url 'faculty_staff:session_students' session.id %}" class="btn btn-sm btn-outline">
                                <i class="fas fa-times mr-2"></i>
                                Clear
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Students Table -->
        <div class="card bg-base-100 shadow-lg">
            <div class="card-body">
                <h2 class="card-title text-xl text-base-content mb-4">
                    <i class="fas fa-users mr-2"></i>
                    Students
                </h2>
                {% if students %}
                    <!-- Table for sm and above -->
                    <div class="overflow-x-auto hidden sm:block">
                        <table class="table table-sm w-full">
                            <thead class="bg-base-200">
                                <tr>
                                    <th class="text-xs text-base-content/80">Name</th>
                                    <th class="text-xs text-base-content/80">University Roll No</th>
                                    <th class="text-xs text-base-content/80 hidden sm:table-cell">College Roll No</th>
                                    <th class="text-xs text-base-content/80 hidden sm:table-cell">Program</th>
                                    <th class="text-xs text-base-content/80">Status</th>
                                    <th class="text-xs text-base-content/80 hidden sm:table-cell">Enrollment Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for student in students %}
                                <tr class="hover:bg-base-200/50">
                                    <td class="text-xs text-base-content truncate max-w-[150px]">
                                        <a href="{% url 'faculty_staff:student_detail' student.pk %}" class="link link-primary">
                                            {{ student.applicant.full_name }}
                                        </a>
                                        <br>
                                        <a href="{% url 'faculty_staff:student_semester_performance' student.pk %}" class="link link-secondary text-xs">
                                            View Semester Performance
                                        </a>
                                    </td>
                                    <td class="text-xs text-base-content">{{ student.university_roll_no|default:"N/A" }}</td>
                                    <td class="text-xs text-base-content hidden sm:table-cell">{{ student.college_roll_no|default:"N/A" }}</td>
                                    <td class="text-xs text-base-content hidden sm:table-cell">{{ student.program.name }}</td>
                                    <td class="text-xs text-base-content">
                                        <span class="badge badge-xs {% if student.current_status == 'active' %}badge-success{% elif student.current_status == 'graduated' %}badge-info{% else %}badge-error{% endif %}">
                                            {{ student.current_status|title }}
                                        </span>
                                    </td>
                                    <td class="text-xs text-base-content hidden sm:table-cell">{{ student.enrollment_date|date:"Y-m-d" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <!-- Cards for mobile -->
                    <div class="block sm:hidden space-y-4">
                        {% for student in students %}
                        <div class="card bg-base-100 shadow-md">
                            <div class="card-body p-4">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-sm font-semibold text-base-content truncate max-w-[200px]">
                                        <a href="{% url 'faculty_staff:student_detail' student.pk %}" class="link link-primary">
                                            {{ student.applicant.full_name }}
                                        </a>
                                        <br>
                                        <a href="{% url 'faculty_staff:student_semester_performance' student.pk %}" class="link link-secondary text-xs">
                                            View Semester Performance
                                        </a>
                                    </h3>
                                    <span class="badge badge-xs {% if student.current_status == 'active' %}badge-success{% elif student.current_status == 'graduated' %}badge-info{% else %}badge-error{% endif %}">
                                        {{ student.current_status|title }}
                                    </span>
                                </div>
                                <p class="text-xs text-base-content">Roll No: {{ student.university_roll_no|default:"N/A" }}</p>
                                <div class="collapse collapse-arrow">
                                    <input type="checkbox" />
                                    <div class="collapse-title text-xs text-base-content/70">More Details</div>
                                    <div class="collapse-content text-xs text-base-content space-y-1">
                                        <p><strong>College Roll No:</strong> {{ student.college_roll_no|default:"N/A" }}</p>
                                        <p><strong>Program:</strong> {{ student.program.name }}</p>
                                        <p><strong>Enrollment Date:</strong> {{ student.enrollment_date|date:"Y-m-d" }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info shadow-sm mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="text-center">
                            <h3 class="text-lg font-semibold text-base-content/70 mb-2">No Students Found</h3>
                            <p class="text-base-content/50">No students are enrolled in {{ session.name }} for {{ department.name }}. Check the session or add new applicants.</p>
                        </div>
                    </div>
                {% endif %}

                <!-- Pagination -->
                {% if students.has_other_pages %}
                <div class="join mt-4 flex justify-center">
                    {% if students.has_previous %}
                    <a href="?page={{ students.previous_page_number }}&q={{ request.GET.q|default:'' }}" class="btn btn-sm btn-outline join-item">Previous</a>
                    {% endif %}
                    {% for num in students.paginator.page_range %}
                    <a href="?page={{ num }}&q={{ request.GET.q|default:'' }}" class="btn btn-sm btn-outline join-item {% if students.number == num %}btn-active{% endif %}">{{ num }}</a>
                    {% endfor %}
                    {% if students.has_next %}
                    <a href="?page={{ students.next_page_number }}&q={{ request.GET.q|default:'' }}" class="btn btn-sm btn-outline join-item">Next</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}