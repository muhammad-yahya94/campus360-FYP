{% extends 'fee_management/office_base.html' %}
{% block title %}Applicant Verification{% endblock %}
{% block content %}
<div class="hero bg-base-200 rounded-xl shadow-lg mb-8 py-6">
  <div class="hero-content text-center">
    <div class="max-w-md">
      <h1 class="text-3xl sm:text-4xl font-bold text-base-content">Applicant Verification</h1>
      <p class="text-base-content mt-2">Filter and sort applicants by program and shift</p>
    </div>
  </div>
</div>

<div class="max-w-6xl mx-auto bg-base-100 rounded-xl shadow-lg p-8">
  <!-- Filter and Sort Form -->
  <div class="card bg-base-100 shadow-md p-6 mb-8">
    <h2 class="text-2xl font-semibold mb-4 text-base-content">Filter & Sort Applicants</h2>
    <hr class="mb-4 border-base-300">
    <form method="get" class="grid grid-cols-1 sm:grid-cols-5 gap-4">
      <div>
        <label for="program" class="block text-sm font-medium text-base-content">Program</label>
        <select name="program" id="program" class="select select-bordered w-full" aria-label="Filter by Program">
          <option value="">All Programs</option>
          {% for program in programs %}
            <option value="{{ program.id }}" {% if program.id|stringformat:"s" == selected_program %}selected{% endif %}>{{ program.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label for="shift" class="block text-sm font-medium text-base-content">Shift</label>
        <select name="shift" id="shift" class="select select-bordered w-full" aria-label="Filter by Shift">
          <option value="">All Shifts</option>
          <option value="morning" {% if selected_shift == "morning" %}selected{% endif %}>Morning</option>
          <option value="evening" {% if selected_shift == "evening" %}selected{% endif %}>Evening</option>
        </select>
      </div>
      <div>
        <label for="sort" class="block text-sm font-medium text-base-content">Sort By</label>
        <select name="sort" id="sort" class="select select-bordered w-full" aria-label="Sort Applicants">
          <option value="">Default</option>
          <option value="full_name" {% if selected_sort == "full_name" %}selected{% endif %}>Name (A-Z)</option>
          <option value="-full_name" {% if selected_sort == "-full_name" %}selected{% endif %}>Name (Z-A)</option>
          <option value="program__name" {% if selected_sort == "program__name" %}selected{% endif %}>Program (A-Z)</option>
          <option value="-program__name" {% if selected_sort == "-program__name" %}selected{% endif %}>Program (Z-A)</option>
          <option value="shift" {% if selected_sort == "shift" %}selected{% endif %}>Shift (A-Z)</option>
          <option value="-shift" {% if selected_sort == "-shift" %}selected{% endif %}>Shift (Z-A)</option>
        </select>
      </div>
      <div class="flex items-end">
        <button type="submit" class="btn btn-primary w-full">Apply Filters</button>
      </div>
      <div class="flex items-end">
        <a href="{% url 'fee_management:applicant_verification' %}" class="btn btn-secondary w-full">Reset Filters</a>
      </div>
    </form>
  </div>

  <!-- Applicants Table -->
  <div class="card bg-base-100 shadow-md p-6">
    <h2 class="text-2xl font-semibold mb-4 text-base-content">Applicants List</h2>
    <hr class="mb-4 border-base-300">
    {% if applicants %}
    <div class="overflow-x-auto">
      <table class="table w-full">
        <thead>
          <tr>
            <th scope="col">Full Name</th>
            <th scope="col">Program</th>
            <th scope="col">Shift</th>
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for applicant in applicants %}
          <tr>
            <td>{{ applicant.full_name|default:"N/A" }}</td>
            <td>{{ applicant.program.name|default:"N/A" }}</td>
            <td>{{ applicant.shift|title|default:"N/A" }}</td>
            <td>
              <span class="badge {% if applicant.status == 'pending' %}badge-warning{% elif applicant.status == 'accepted' %}badge-success{% else %}badge-error{% endif %} tooltip" data-tip="{{ applicant.status|title }} status" role="status" aria-label="Applicant Status: {{ applicant.status|title|default:'N/A' }}">
                {{ applicant.status|title|default:"N/A" }}
              </span>
            </td>
            <td>
              <a href="{% url 'fee_management:view_applicant' applicant.id %}" class="btn btn-sm btn-primary mr-2">View</a>
              <a href="{% url 'fee_management:verify_applicant' applicant.id %}" class="btn btn-sm btn-secondary">Verify</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Pagination -->
    {% if applicants.has_other_pages %}
    <div class="mt-6 flex justify-center">
      <div class="join">
        {% if applicants.has_previous %}
        <a href="?page={{ applicants.previous_page_number }}{% if request.GET.program %}&program={{ request.GET.program }}{% endif %}{% if request.GET.shift %}&shift={{ request.GET.shift }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="join-item btn">«</a>
        {% endif %}
        {% for num in applicants.paginator.page_range %}
        <a href="?page={{ num }}{% if request.GET.program %}&program={{ request.GET.program }}{% endif %}{% if request.GET.shift %}&shift={{ request.GET.shift }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="join-item btn {% if applicants.number == num %}btn-active{% endif %}">{{ num }}</a>
        {% endfor %}
        {% if applicants.has_next %}
        <a href="?page={{ applicants.next_page_number }}{% if request.GET.program %}&program={{ request.GET.program }}{% endif %}{% if request.GET.shift %}&shift={{ request.GET.shift }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}" class="join-item btn">»</a>
        {% endif %}
      </div>
    </div>
    {% endif %}
    {% else %}
    <p class="text-base-content text-center">No applicants found matching the selected filters.</p>
    {% endif %}
  </div>
</div>
{% endblock %}