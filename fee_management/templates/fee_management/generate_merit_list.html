{% extends 'fee_management/office_base.html' %}
{% block title %}Generate Merit List{% endblock %}
{% block content %}
<div class="hero bg-base-200 rounded-xl shadow-lg mb-8 py-6">
  <div class="hero-content text-center">
    <div class="max-w-md">
      <h1 class="text-3xl sm:text-4xl font-bold text-base-content">Generate Merit List</h1>
    </div>
  </div>
</div>

<div class="max-w-2xl mx-auto bg-base-100 rounded-xl shadow-lg p-8">
  {% if errors %}
  <div class="alert alert-error mb-6">
    <ul>
      {% for error in errors %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <form method="post" autocomplete="off" class="space-y-6">
  {% csrf_token %}
  
  <div class="form-control">
    <label class="label" for="id_program">
      <span class="label-text">Program</span>
    </label>
    <select name="program" id="id_program" class="select select-bordered w-full" required>
      <option value="">Select a program</option>
      {% for program in programs %}
        <option value="{{ program.id }}">{{ program.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="form-control">
    <label class="label" for="id_shift">
      <span class="label-text">Shift</span>
    </label>
    <select name="shift" id="id_shift" class="select select-bordered w-full" required>
      <option value="">Select shift</option>
      <option value="morning">Morning</option>
      <option value="evening">Evening</option>
    </select>
  </div>

  <div class="form-control">
    <label class="label" for="id_list_number">
      <span class="label-text">Merit List Number</span>
    </label>
    <input type="number" name="list_number" id="id_list_number" class="input input-bordered w-full" readonly>
  </div>
    <div class="form-control">
    <label class="label" for="id_list_number">
      <span class="label-text">Merit List Number</span>
    </label>
    <input type="number" name="no_of_seats" id="no_of_seats" class="input input-bordered w-full">
  </div>
    <div class="form-control">
      <label class="label" for="valid_until">
        <span class="label-text">Valid Until</span>
      </label>
      <input type="datetime-local" name="valid_until" id="valid_until" class="input input-bordered w-full" required>
    </div>
 
    <div class="form-control">
      <label class="label" for="notes">
        <span class="label-text">Notes (Optional)</span>
      </label>
      <textarea name="notes" id="notes" class="textarea textarea-bordered w-full" rows="3" placeholder="Any additional notes about this merit list"></textarea>
    </div>

    <div class="form-control mt-6">
      <button type="submit" class="btn btn-primary w-full">Generate Merit List</button>
    </div>
  </form>

  <div class="mt-8 text-center">
    <a href="{% url 'fee_management:manage_merit_lists' %}" class="btn btn-outline">View All Merit Lists</a>
  </div>
</div>

<div class="mt-8 bg-info rounded-xl p-6">
  <h3 class="text-lg font-semibold mb-2">How Merit List Generation Works:</h3>
  <ul class="list-disc list-inside space-y-1 text-sm">
    <li>Only <strong>accepted</strong> applicants are considered for merit list generation</li>
    <li>For <strong>BS programs</strong>: Selection based on Intermediate/FSc percentage</li>
    <li>For <strong>MS programs</strong>: Selection based on Bachelor's degree percentage</li>
    <li>Students are ranked by their relevant percentage (highest first)</li>
    <li>Only the <strong>top 50 students</strong> are selected for each program</li>
    <li>Each selected student gets a merit position and status tracking</li>
  </ul>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const programSelect = document.getElementById('id_program');
  const shiftSelect = document.getElementById('id_shift');
  const listNumberInput = document.getElementById('id_list_number');

  function updateListNumber() {
    const programId = programSelect.value;
    const shift = shiftSelect.value;

    if (programId && shift) {
      fetch(`{% url 'fee_management:get_next_list_number' %}?program=${programId}&shift=${shift}`)
        .then(response => response.json())
        .then(data => {
          listNumberInput.value = data.next_list_number;
        })
        .catch(error => console.error('Error:', error));
    }
  }

  programSelect.addEventListener('change', updateListNumber);
  shiftSelect.addEventListener('change', updateListNumber);
});
</script>
{% endblock %}
