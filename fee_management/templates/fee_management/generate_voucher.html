{% extends 'fee_management/office_base.html' %}
{% block title %}Generate Fee Voucher{% endblock %}
{% block content %}


<!-- Hero Section -->
<div class="mb-6">
  <div id="hero-section" class="hero bg-base-200 rounded-lg shadow-lg py-8 section-content">
    <div class="hero-content text-center">
      <div class="max-w-md">
        <h1 class="text-3xl sm:text-4xl font-bold text-base-content mb-2">Fee Voucher Generator</h1>
        <p class="text-base sm:text-lg text-base-content/90">Enter a student's university roll number and semester to generate a fee voucher.</p>
      </div>
    </div>
  </div>
</div>

<!-- Voucher Form Section -->
<div class="mb-6">
  <div class="flex justify-between items-center mb-2">
    <h2 class="text-xl font-semibold text-base-content">Enter Voucher Details</h2>
  </div>
  <div id="voucher-form-section" class="max-w-full mx-auto bg-base-100 rounded-xl shadow-xl p-8 mb-8 section-content">
    <form method="post" class="space-y-6">
      {% csrf_token %}
      {% if errors %}
      <div class="bg-error/10 border border-error rounded-lg p-4 text-error">
        {% for error in errors %}
        <p>{{ error }}</p>
        {% endfor %}
      </div>
      {% endif %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <label class="block mb-2 font-semibold text-base-content" for="university_roll_no">University Roll Number</label>
          <input type="number" id="university_roll_no" name="university_roll_no" class="input input-bordered w-full rounded-lg" min="0" required oninput="fetchSemesters()">
        </div>
        <div>
          <label class="block mb-2 font-semibold text-base-content" for="semester">Semester</label>
          <select id="semester" name="semester" class="select select-bordered w-full rounded-lg" required>
            <option value="">Select Semester</option>
            <!-- Populated by AJAX -->
          </select>
        </div>
      </div>
      <button type="submit" class="btn btn-primary w-full rounded-lg">Generate Voucher</button>
    </form>
  </div>
</div>

<script>

function fetchSemesters() {
  const rollNo = document.getElementById('university_roll_no').value;
  const semesterSelect = document.getElementById('semester');
  semesterSelect.innerHTML = '<option value="">Select Semester</option>';

  if (rollNo) {
    fetch(`/fees/get_semesters_by_roll/?roll_no=${rollNo}`)
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          console.error('Error:', data.error);
          alert(data.error);
        } else {
          data.semesters.forEach(semester => {
            const option = document.createElement('option');
            option.value = semester.id;
            option.textContent = `${semester.name} (${semester.program_name}) (${semester.session})`;
            semesterSelect.appendChild(option);
          });
        }
      })
      .catch(error => {
        console.error('Error fetching semesters:', error);
        alert('Error fetching semesters.');
      });
  }
}
</script>
{% endblock %}