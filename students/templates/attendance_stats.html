{% extends 'base_student.html' %}

{% block title %}Attendance Statistics - {{ student.applicant.full_name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Hero Section -->
  <div class="hero bg-base-200 rounded-lg shadow-lg mb-6">
    <div class="hero-content text-center">
      <div class="max-w-md">
        <h1 class="text-3xl sm:text-4xl font-bold text-base-content mb-2">Attendance Statistics</h1>
        <p class="text-base sm:text-lg text-base-content/90">View your attendance stats across all semesters, {{ student.applicant.full_name }}.</p>
      </div>
    </div>
  </div>

  <!-- Semester Number Pagination -->
  {% if stats_by_semester.paginator.num_pages > 1 %}
    <div class="mb-6">
      <div class="tabs tabs-bordered flex flex-wrap gap-2">
        {% for num in stats_by_semester.paginator.page_range %}
          <a href="?page={{ num }}"
             class="tab tab-lg {% if stats_by_semester.number == num %}tab-active bg-primary text-primary-content{% else %}text-base-content/70 hover:text-base-content{% endif %}">
            Semester {{ num }}
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <!-- Attendance Tables -->
  {% for sem_stats in stats_by_semester %}
    <div class="card bg-base-100 shadow-lg rounded-lg overflow-hidden mb-6">
      <div class="card-body">
        <h2 class="card-title text-2xl text-base-content mb-4 flex items-center">
          <i class="fas fa-calendar-check text-primary mr-2"></i> {{ sem_stats.semester.name }} {% if sem_stats.semester == active_semester %}(Current){% endif %}
        </h2>
        <!-- Semester Stats -->
        <div class="card bg-base-100 shadow-md mb-4">
          <div class="card-body">
            <h3 class="text-lg font-medium text-base-content mb-2">Semester Summary</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
              <div class="stat">
                <div class="stat-title">Total Attendance</div>
                <div class="stat-value text-base-content">{{ sem_stats.semester_stats.total_count }}</div>
              </div>
              <div class="stat">
                <div class="stat-title">Present</div>
                <div class="stat-value text-success">{{ sem_stats.semester_stats.present_count }}</div>
              </div>
              <div class="stat">
                <div class="stat-title">Absent</div>
                <div class="stat-value text-error">{{ sem_stats.semester_stats.absent_count }}</div>
              </div>
              <div class="stat">
                <div class="stat-title">Leave</div>
                <div class="stat-value text-warning">{{ sem_stats.semester_stats.leave_count }}</div>
              </div>
              <div class="stat">
                <div class="stat-title">Percentage</div>
                <div class="stat-value text-primary">{{ sem_stats.semester_stats.percentage|floatformat:2 }}%</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Course Stats -->
        {% if sem_stats.course_stats %}
          <div class="overflow-x-auto">
            <table class="table w-full bg-base-100">
              <thead>
                <tr>
                  <th class="text-sm font-semibold text-base-content/80">Course</th>
                  <th class="text-sm font-semibold text-base-content/80">Total</th>
                  <th class="text-sm font-semibold text-base-content/80">Present</th>
                  <th class="text-sm font-semibold text-base-content/80">Absent</th>
                  <th class="text-sm font-semibold text-base-content/80">Leave</th>
                  <th class="text-sm font-semibold text-base-content/80">Percentage</th>
                </tr>
              </thead>
              <tbody>
                {% for stat in sem_stats.course_stats %}
                  <tr>
                    <td class="text-sm text-base-content">{{ stat.course.code }} - {{ stat.course.name }}</td>
                    <td class="text-sm text-base-content">{{ stat.total }}</td>
                    <td class="text-sm">
                      <span class="badge bg-success text-success-content">{{ stat.present }}</span>
                    </td>
                    <td class="text-sm">
                      <span class="badge bg-error text-error-content">{{ stat.absent }}</span>
                    </td>
                    <td class="text-sm">
                      <span class="badge bg-warning text-warning-content">{{ stat.leave }}</span>
                    </td>
                    <td class="text-sm">
                      <div class="flex items-center gap-2">
                        <span class="font-bold text-primary">{{ stat.percentage|floatformat:2 }}%</span>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="6" class="text-sm text-base-content/50">
                      <div class="flex items-center gap-2">
                        <div class="w-full bg-base-200 rounded-full h-2.5">
                          <div class="bg-primary h-2.5 rounded-full" style="width: {{ stat.percentage }}%"></div>
                        </div>
                      </div>
                    </td>
                  </tr>  
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-info shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>No course attendance stats available for {{ sem_stats.semester.name }}.</span>
          </div>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <div class="alert alert-info shadow-lg">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span>No attendance statistics available.</span>
    </div>
  {% endfor %}
</div>
{% endblock %}