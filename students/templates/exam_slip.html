{% extends 'base_student.html' %}
{% load static %}

{% block title %}Exam Roll Number Slips - {{ student.applicant.full_name }}{% endblock %}

{% block extra_css %}
<style>
    @media print {
        /* Hide elements not needed for printing */
        .no-print, nav, .tabs, .hero, .btn {
            display: none !important;
        }
        /* Ensure content takes full width when printing */
        .print-content {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        /* Add page breaks where needed */
        .page-break {
            page-break-before: always;
        }
        /* Ensure tables don't break across pages */
        table { page-break-inside: auto; }
        tr    { page-break-inside:avoid; page-break-after:auto }
        thead { display:table-header-group; }
        tfoot { display:table-footer-group; }
        /* Adjust spacing for print */
        body {
            padding: 20px !important;
            font-size: 12pt !important;
            line-height: 1.4 !important;
        }
        /* Ensure images have proper dimensions when printed */
        .student-photo {
            max-width: 80px !important;
            height: auto !important;
        }
    }
    .student-info {
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
    }
    .student-photo {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 0.5rem;
    }
    .exam-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 0.5rem;
        overflow: hidden;
    }
    .exam-table th,
    .exam-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid;
        border-color: inherit; /* Inherits from theme's border color */
    }
    .exam-table th {
        font-weight: 600;
    }
    .exam-table tr:last-child td {
        border-bottom: none;
    }
    .instructions-card {
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-top: 1.5rem;
    }
    .instructions-card ol {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        list-style-position: inside;
    }
    .instructions-card li {
        flex: 1 1 45%;
        line-height: 1.5;
    }
    .print-button {
        position: fixed;
        top: 120px;
        right: 2rem;
        z-index: 1000;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background-color: #4f46e5;
        color: white;
        font-weight: 500;
        font-size: 0.875rem;
        line-height: 1.25rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        transition: all 0.15s ease-in-out;
        border: none;
        cursor: pointer;
        gap: 0.5rem;
    }
    .print-button:hover {
        background-color: #4338ca;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .print-button:focus {
        outline: 2px solid transparent;
        outline-offset: 2px;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
    }
    .print-button i {
        font-size: 1.125rem;
    }
    @media print {
        .print-button {
            display: none !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Print Button -->
<button onclick="window.print()" class="print-button no-print" title="Print Exam Slip">
    <i class="fas fa-print"></i>
    <span>Print Slip</span>
</button>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 print-content">
    <!-- Hero Section -->
    <div class="hero bg-base-200 rounded-lg shadow-lg mb-6 no-print">
        <div class="hero-content text-center">
            <div class="max-w-md">
                <h1 class="text-3xl sm:text-4xl font-bold text-base-content mb-2">Exam Roll Number Slips</h1>
                <p class="text-base sm:text-lg text-base-content/90">Welcome, {{ student.applicant.full_name }}! View your exam schedule for {{ selected_semester_number|default:"current semester" }}.</p>
            </div>
        </div>
    </div>

    <!-- Student Information -->
    <div class="page-break-after"></div>
    <div class="student-info bg-base-100 shadow-md mb-6 print-section">
        <div class="flex flex-col sm:flex-row items-center gap-4">
            {% if student.applicant.applicant_photo %}
                <img src="{{ student.applicant.applicant_photo.url }}" alt="Student Photo" class="student-photo">
            {% else %}
                <div class="student-photo bg-base-300 flex items-center justify-center text-base-content/70">
                    No Photo
                </div>
            {% endif %}
            <div>
                <p class="text-lg"><strong>Student Name:</strong> {{ student.applicant.full_name }}</p>
                <p class="text-lg"><strong>University Roll Number:</strong> {{ student.university_roll_no }}</p>
                <p class="text-lg"><strong>Program:</strong> {{ student.program.name }}</p>
                <p class="text-lg"><strong>Session:</strong> {{ student.applicant.session }}</p>
            </div>
        </div>
    </div>

    <!-- Exam Slips Table -->
    <div class="page-break-before"></div>
    {% if exam_slips %}
        <div class="card bg-base-100 shadow-lg rounded-lg overflow-hidden mb-6">
            <div class="card-body">
                <h2 class="card-title text-2xl text-base-content mb-4">Exam Schedule for  {{ current_semester }}</h2>
                <div class="overflow-x-auto">
                    <table class="exam-table">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Course Code</th>
                                <th>Exam Type</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Exam Center</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for slip in exam_slips %}
                                <tr>
                                    <td>{{ slip.course_offering.course.name }}</td>
                                    <td>{{ slip.course_offering.course.code }}</td>
                                    <td>{{ slip.get_exam_type_display }}</td>
                                    <td>{{ slip.exam_date|date:"F d, Y" }}</td>
                                    <td>{{ slip.start_time|time:"H:i" }} - {{ slip.end_time|time:"H:i" }}</td>
                                    <td>{{ slip.exam_center }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Instructions for Candidates -->
        <div class="page-break-before"></div>
        <div class="instructions-card bg-base-100 shadow-md print-section">
            <h3 class="text-xl font-semibold text-base-content mb-4">Instructions for Candidates</h3>
            <ol class="text-base-content/80">
                <li>No student will be allowed to enter the Examination Hall after 30 minutes of the start of the paper.</li>
                <li>Students are directed to follow the timings given in the date sheet.</li>
                <li>No student will be allowed to enter the Examination Center without ID card and Roll Number Slip.</li>
                <li>No student will be allowed to leave the Examination Hall before half of the time is over.</li>
                <li>No change of Centre is allowed without the permission of Controller of Examinations.</li>
                <li>Any kind of programmable calculator is not allowed in the Examination Hall.</li>
                <li>Mobile Phone is not allowed in the Examination Hall.</li>
                <li>The order in which the candidates are seated will be forwarded to the Examiner. As and when a candidate is discovered to have copied/cheated from another source, UMC will be filed under rules and he/she will be expelled from the Examination. Moreover, the candidate from whom he/she copied will also be penalized.</li>
                <li>No candidate shall be allowed to speak without prior permission of the superintendent during exam.</li>
                <li>Before attempting the answer sheet, each candidate must fill the title page of the answer sheet completely. The blank pages/portion of the answer sheet must be crossed before handing over to Superintendent.</li>
                <li>No candidate shall give any mark of identification inside his/her answer script at specified places, otherwise the paper of the candidate will be cancelled.</li>
                <li>Highlighter, ink remover, and all kinds of erasers are not allowed in the Examination Hall, only blue ink pen is allowed.</li>
            </ol>
        </div>
    {% else %}
        <div class="alert alert-info shadow-lg mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>No exam slips found.</span>
        </div>
    {% endif %}
</div>
{% endblock %}