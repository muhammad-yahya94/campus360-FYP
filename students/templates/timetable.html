{% extends 'base_student.html' %}

{% block title %}My Timetable - {{ student.applicant.full_name }}{% endblock %}

{% block content %}

<div class="container mx-auto p-4">
<div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Header -->

  <div class="hero bg-base-200 rounded-lg shadow-lg mb-6">
    <div class="hero-content text-center">
      <div class="max-w-md">
        <h1 class="text-3xl sm:text-4xl font-bold text-base-content mb-2">My Timetable</h1>
        <p class="text-base sm:text-lg text-base-content/90">{{ student.applicant.full_name }} - {{ student.program.department.name }} - {{ active_session.name|default:'No Active Session' }}</p>
      </div>
    </div>
  </div>
  <!-- Timetable -->
  <div class="card bg-base-100 shadow-lg rounded-lg">
    <div class="card-body">
      <h2 class="card-title text-2xl text-base-content mb-4">
        <i class="fas fa-calendar-week mr-2"></i>
        My Schedule
      </h2>
      {% if timetable_data %}
        <div class="space-y-4">
          {% for day in timetable_data %}
            <div class="card bg-base-100 border border-base-200 rounded-lg">
              <button class="card-title w-full flex justify-between items-center p-4 bg-base-200 hover:bg-base-300 transition duration-200" onclick="toggleDay('{{ day.day_value }}')">
                <span class="text-lg font-semibold text-base-content">{{ day.day_label }}</span>
                <i id="toggle-icon-{{ day.day_value }}" class="fas fa-chevron-down text-base-content"></i>
              </button>
              <div id="slots-{{ day.day_value }}" class="p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for slot in day.slots %}
                  <div class="card shadow-md transition duration-200 {% if slot.shift == 'Morning' %}bg-primary/10 border-primary/20 hover:bg-primary/20{% elif slot.shift == 'Evening' %}bg-secondary/10 border-secondary/20 hover:bg-secondary/20{% else %}bg-accent/10 border-accent/20 hover:bg-accent/20{% endif %}" data-tooltip="Program: {{ slot.program }}  Semester: {{ slot.semester }}">
                    <div class="card-body">
                      <p class="font-semibold text-lg {% if slot.shift == 'Morning' %}text-primary{% elif slot.shift == 'Evening' %}text-secondary{% else %}text-accent{% endif %}">{{ slot.course_code }} - {{ slot.course_name }}</p>
                      <p class="text-sm text-base-content/70"><i class="fas fa-user-tie mr-1"></i>Teacher: {{ slot.teacher_name }}</p>
                      <p class="text-sm text-base-content/70"><i class="fas fa-map-marker-alt mr-1"></i>{{ slot.venue }} - Room {{ slot.room_no }}</p>
                      <p class="text-sm text-base-content/70"><i class="fas fa-clock mr-1"></i>{{ slot.start_time }}â€“{{ slot.end_time }}</p>
                    </div>
                  </div>
                {% empty %}
                  <p class="col-span-full text-center text-base-content/70">No slots scheduled for {{ day.day_label }}.</p>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>You have no scheduled classes for this academic session.</span>
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% block extra_js %}
<script>
function toggleDay(dayId) {
  const slots = document.getElementById(`slots-${dayId}`);
  const icon = document.getElementById(`toggle-icon-${dayId}`);
  if (slots.classList.contains('hidden')) {
    slots.classList.remove('hidden');
    icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
  } else {
    slots.classList.add('hidden');
    icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
  }
}

// Initialize all days as expanded
document.querySelectorAll('[id^="slots-"]').forEach(el => el.classList.remove('hidden'));

// Tooltip functionality
document.querySelectorAll('[data-tooltip]').forEach(el => {
  const tooltip = document.createElement('div');
  tooltip.innerHTML = el.dataset.tooltip;
  tooltip.className = 'absolute hidden group-hover:block bg-base-300 text-base-content text-xs rounded p-2 -top-10 left-1/2 transform -translate-x-1/2 z-10';
  el.classList.add('group', 'relative');
  el.appendChild(tooltip);
});
</script>
<style>
/* Ensure Tailwind group-hover works */
.group:hover .group-hover\:block {
  display: block;
}
</style>
{% endblock %}
{% endblock %}